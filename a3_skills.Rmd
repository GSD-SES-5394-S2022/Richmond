---
title: "Skills for Analysis Assignment 3"
author: "GSD SES 5394"
date: "Spring 2022"
output: 
  rmdformats::material
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview

The followings skills will be useful for Analysis Assignment 3. They are listed here alphabetically. I don't want to bias your thinking about which ones you'll end up using and in what order. But this page will be a useful reference.

*Note: In general, you should load all your libraries at the beginning of your script or markdown file. In these examples, I'm loading libraries at the top of each code chunk to make it more clear which methods use which packages.*

* **Compare skims**:

* **Convert an OSM file to a PBF file**:

* **Delete a transit route**

* **Download an OpenStreetMap network**: You'll need to represent the existing roadway network in a format that will allow you to calculate travel times. OpenStreetMaps is helpful for this.

* **Download a GTFS feed**:

* **Edit an OpenStreetMap network**: If the alternative you want to evaluate involves changes to the road network, you'll need to save a copy of the existing OpenStreetMap network you downloaded (see the "Download and OpenStreetMap network" topic), and prepare it for editing (see the "Prepare an OpenStreetMap network for editing" topic).

* **Edit transit route frequency**:

* **Edit transit route speed**:

* **Generate skims**:

* **Install a package from GitHub**: If you want to edit the the transit network or the street network, you'll find the `scenRios` package useful. This is a package I wrote specifically for this class (like, yesterday), and it's still very much in beta. You'll need to install it from GitHub (this is common for beta versions of new or updated packages).

* **Prepare an OpenStreetMap network for editing**: The OSM file you download from the Overpass API (see the "Download an OpenStreetMap network" topic) will not include version tags, but to edit the file using JOSM (see the "Edit an OpenStreetMap network" topic), you'll need to have those.

* **View GTFS routes**:

* **View GTFS service plans**:

# Compare skims

# Convert an OSM file to a PBF file

# Delete a transit route

# Download an OpenStreetMap network

You'll need to represent the existing roadway network in a format that will allow you to calculate travel times. OpenStreetMaps is helpful for this. 

The `osmdata` package includes functions to build a queries to request data from the [Overpass API](https://wiki.openstreetmap.org/wiki/Overpass_API) within a defined bounding box.

First you'll need to use the `st_bbox()` function to define the bounding box based on the boundary of your study area. 

Then you can use the `opq()` function to request OpenStreetMap data within that bounding box. `add_osm_feature()` lets you specify which types of features you want to request. By setting `key = 'highway'`, you indicate that you want all the roads (OpenStreetMaps refers to all roads, including pedestrian paths, as [highways](https://wiki.openstreetmap.org/wiki/Key:highway)). Finally, you can use `osmdata_xml()` to download and save the data you've requested to an OSM file.

```{r, eval=FALSE}
library(sf)
library(tigris)
library(tidyverse)
library(osmdata)

boundary <- core_based_statistical_areas() %>%
  filter(GEOID == "40060")

richmond_bbox <- st_bbox(boundary)

q <- opq(bbox = richmond_bbox) %>%
  add_osm_feature(key = 'highway') %>%
  osmdata_xml(file = 'existing/networks/streets.osm')
```

# Download a GTFS feed

# Edit an OpenStreetMap network

If the alternative you want to evaluate involves changes to the road network, you'll need to save a copy of the existing OpenStreetMap network you downloaded (see the "Download and OpenStreetMap network" topic), and prepare it for editing (see the "Prepare an OpenStreetMap network for editing" topic).

You'll be editing using a software package called JOSM (Java OpenStreetMap Editor). You already have a copy of it in your project directory (which I downloaded from [here](https://josm.openstreetmap.de/wiki/Download){target="_blank"} and added to your GitHub repo). If you are working on a fairly small study area, you can just open it by double-clicking on it (this would be fine for Buffalo, I think). If you are working on a larger region, you'll probably need to increase the memory allocated to Java when you open it, so you should open it from the command line.

[Here's a little video](https://harvard.zoom.us/rec/share/vwQJatxnxypwI0hvgfD5l8zJbhqIeRa3jp_DbCzu9cW45zYD8mYsrAb8gRnjHo4I.2NVrqt3owFoGPLz2){target="_blank"} that shows you how to open the command line from a PC.

And here's one that shows you how to open the command line from a Mac.

Once you've got the command line open, navigate to the folder where the JOSM jar file is saved. To do this, type `cd` followed by a space, then type the path to the networks subfolder the alternative folder in your GitHub repo. On a PC, it will probably be something like this:

`cd Documents\GitHub\Richmond\alternative\networks`

Then type:

`java -jar -Xmx2g josm-tested.jar`

The `-Xmx2g` allocates two gigabytes of memory to Java. 

This will open JOSM on your computer. Here's a video showing what to do from there.

# Edit transit route frequency

# Edit transit route speed

# Generate skims

# Install a package from GitHub

If you want to edit the the transit network or the street network, you'll find the `scenRios` package useful. This is a package I wrote specifically for this class (like, yesterday), and it's still very much in beta. You'll need to install it from GitHub (this is common for beta versions of new or updated packages).

To install a package from GitHub, you can use the `install_github()` function in the `devtools` package, with the url for the repo where the package is. The repo for the scenRios package is at `https://github.com/c-voulgaris/scenRios`.

```{r, eval=FALSE}
library(devtools)

install_github("https://github.com/c-voulgaris/scenRios")
```


# Prepare an OpenStreetMap network for editing

The OSM file you download from the Overpass API (see the "Download an OpenStreetMap network" topic) will not include version tags, but to edit the file using JOSM (see the "Edit an OpenStreetMap network" topic), you'll need to have those.

The scenRios package includes a function called `osm_prep_network` that will add those for you. You'll need to load the contents of the file using `read_lines()`, then you can use `osm_prep_network()` to add the version tags, and then you can use `write_lines()` to save a modified version of the network that you can edit in JOSM.

```{r, eval=FALSE}
library(scenRios)
library(tidyverse)

old_network <- read_lines("existing/networks/streets.osm")

new_network <- osm_prep_network(old_network)

write_lines(new_network, file = "alternative/networks/streets.osm")
```

# View GTFS routes

# View GTFS service plans
